sequenceDiagram
    %% View 02 — OS-Level Configuration (Cloud-Init + Ansible)
    %% Follows: View 01 — Terraform Execution
    %% Continues in: View 03 — Cluster Deployment

    participant CI  as Cloud-Init (All Nodes)
    participant ANS as Ansible Controller (Master)
    participant P1  as Base OS & Services
    participant P2  as Ambari & ODP Setup
    participant P3  as Agents Configuration

    Note over CI: Concurrent Boot Execution

    par Initial Setup
        CI->>CI: Update Packages & Setup SSH
        CI->>CI: Configure Hosts & Security (SELinux/Firewall)
        CI->>CI: Install Python & Ansible (Master)
    end

    Note over ANS: Run site.yml Playbook

    ANS->>P1: Execute Play 1 (All Nodes)
    P1->>P1: Install Base Packages (Java, Utils)
    P1->>P1: Setup Swap & Chrony

    ANS->>P2: Execute Play 2 & 3
    P2->>P2: Configure Repositories (ODP & Ambari)
    P2->>P2: Install Ambari Server & PostgreSQL (Master)
    P2->>P2: Initialize Schemas & Databases

    ANS->>P3: Execute Play 4 (All Nodes)
    P3->>P3: Install & Point Ambari Agents to Master
    P3->>P3: Start Agent Services

    ANS-->>ANS: OS configuration complete

    Note over ANS: → Continues in View 03: Cluster Deployment
