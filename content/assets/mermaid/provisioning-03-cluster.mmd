%%{init: {"flowchart": {"padding": 10}}}%%
flowchart TD
    %% View 03 â€” Cluster Deployment & Recovery
    
    START([Begin cluster_deploy.yml]) --> INIT
    
    subgraph DEPLOY [Cluster Deployment]
        INIT[Ambari REST API Availability] --> REG[Register VDF & App Blueprint]
        REG --> APPLY[Apply Cluster Template]
        APPLY --> WAIT[Poll Status]
    end
    
    WAIT --> STATUS{Success?}
    
    STATUS -->|Yes| END_SUCCESS([Cluster Ready])
    
    STATUS -->|No| RETRY_ENGINE
    
    subgraph RETRY_ENGINE [Recovery]
        STOP_AMBARI[Stop Ambari Server] --> CLEAN[Clean HDFS/HBase state]
        CLEAN --> DB_FIX[Reset & Recreate DB]
        DB_FIX --> RESTART[Start Server & Retry]
    end
    
    RESTART -.- |Loop up to 3 times| STATUS
    
    RETRY_ENGINE -->|Max retries| MANUAL
    
    MANUAL[Manual Initialization Script] --> M_STATUS{Success?}
    
    M_STATUS -->|Yes| END_SUCCESS
    M_STATUS -->|No| END_FAIL([Deployment Failed])
    
