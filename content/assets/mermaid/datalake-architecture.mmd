
graph TD
    %% =========================================================
    %%  Data Lake Final Architecture (Default Profile)
    %%  Focus: Functional capabilities, not infrastructure/provisioning
    %% =========================================================

    subgraph INGEST ["① Data Ingestion Layer"]
        direction LR
        KAFKA["Apache Kafka\nReal-time event streaming\n& message bus"]
        NIFI["Apache NiFi\nEvent-driven data flows\n& ETL pipelines"]
        NFS["NFS Gateway\nBatch file ingest\n(POSIX compliance)"]
        
        KAFKA -->|"topics/events"| NIFI
    end

    subgraph STORE ["② Data Storage Layer"]
        direction LR
        HDFS["HDFS\nDistributed File System\n(Raw & Parquet/ORC)"]
        HBASE["Apache HBase\nColumnar NoSQL Database\n(Low-latency access)"]
        HMETA["Hive Metastore\nCentralised schema registry\n(Tables & partitions)"]
        
        HDFS --> HBASE
        HDFS -.-> HMETA
    end

    subgraph PROCESS ["③ Processing & Analytics Layer"]
        direction LR
        YARN["Apache YARN\nDistributed resource\nscheduler & queueing"]
        SPARK["Apache Spark 3\nIn-memory compute\n(Batch & Streaming)"]
        TEZ["Apache Tez\nDAG execution engine\n(Optimised for SQL)"]
        
        YARN --> SPARK
        YARN --> TEZ
        
        HIVE["Hive Server 2\nSQL-on-Hadoop\n(BI tools & queries)"]
        PHOENIX["Phoenix Query Server\nSQL layer over HBase\n(JDBC/ODBC)"]
        
        TEZ --> HIVE
        SPARK -.-> HIVE
    end

    subgraph GOVERN ["④ Governance & Observability Layer"]
        direction LR
        RANGER["Apache Ranger\nCentralised RBAC policies\n& data masking"]
        SOLR["Infra Solr\nAccess audit indexing\n(Full-text search)"]
        ZK["Apache ZooKeeper\nDistributed coordination\n& leader election"]
        AMBARI["Apache Ambari\nCluster lifecycle & health\nmonitoring UI"]
        
        RANGER --> SOLR
        ZK --> RANGER
        AMBARI -.-> ZK
    end

    %% Key relationships between layers
    INGEST -->|"writes raw datasets to"| HDFS
    INGEST -->|"streams fast data to"| HBASE
    
    STORE -->|"provides datasets to"| PROCESS
    PHOENIX -.->|"queries"| HBASE
    
    GOVERN -.->|"enforces policies on"| INGEST
    GOVERN -.->|"enforces policies on"| STORE
    GOVERN -.->|"enforces policies on"| PROCESS


